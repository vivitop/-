import org.telegram.telegrambots.bots.TelegramLongPollingBot;
import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Update;
import org.telegram.telegrambots.meta.exceptions.TelegramApiException;


public class TelegramWalletBot extends TelegramLongPollingBot {

    private String botToken = "7277092887:AAEQJv0CkoC2AaRowQbCi_YrKIlEjCVmv18"; // Замените на ваш токен
    private String botUsername = "Trahkoin_bot"; // Замените на имя вашего бота

    private double trhBalance = 0;  // Баланс TRH (очень простое хранение!)
    private double cpsBalance = 0;  // Баланс CPS (очень простое хранение!)

    @Override
    public String getBotUsername() {
        return botUsername;
    }

    @Override
    public String getBotToken() {
        return botToken;
    }


    @Override
    public void onUpdateReceived(Update update) {
        if (update.hasMessage() && update.getMessage().hasText()) {
            String messageText = update.getMessage().getText();
            long chatId = update.getMessage().getChatId();

            if (messageText.equals("/start")) {
                sendMessage(chatId, "Привет! Ваш баланс: TRH " + trhBalance + ", CPS " + cpsBalance);
            } else if (messageText.startsWith("/buytrh ")) {
                try {
                    double amount = Double.parseDouble(messageText.substring("/buytrh ".length()));
                    trhBalance += amount;
                    sendMessage(chatId, "Вы купили " + amount + " TRH. Новый баланс: " + trhBalance);
                } catch (NumberFormatException e) {
                    sendMessage(chatId, "Неверный формат суммы.");
                }
            } else if (messageText.startsWith("/sendtrh ")) {
                  sendMessage(chatId, "Функция отправки пока не реализована.");
            }else if (messageText.startsWith("/exchangetrhcps ")) {
                try {
                    double amount = Double.parseDouble(messageText.substring("/exchangetrhcps ".length()));
                    if (trhBalance >= amount) {
                        trhBalance -= amount;
                        cpsBalance += amount;
                        sendMessage(chatId, "Вы обменяли " + amount + " TRH на " + amount + " CPS. Новый баланс TRH: " + trhBalance + ", CPS: " + cpsBalance);
                    } else {
                        sendMessage(chatId, "Недостаточно TRH.");
                    }
                } catch (NumberFormatException e) {
                    sendMessage(chatId, "Неверный формат суммы.");
                }
            }else {
                sendMessage(chatId, "Неизвестная команда.");
            }
        }
    }

    private void sendMessage(long chatId, String text) {
        SendMessage message = new SendMessage();
        message.setChatId(String.valueOf(chatId));
        message.setText(text);
        try {
            execute(message);
        } catch (TelegramApiException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        // В этом примере нет полноценного запуска бота, т.к. он не интегрирован с Spring Boot и requires a framework to run
        System.out.println("Simple Telegram Bot running (extremely limited functionality).");
    }
}